# SQL Injection Attack

In the following example, attacks are carried out on a SQL database (specifically SQLite3).

## Dump the Database 

If you have an SQLite3 database file, you can **read the data from the database with a dump 
command**.

```
$ sqlite3 test.db .dump
PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE user (id INTEGER,username TEXT,password TEXT,PRIMARY KEY(id));
INSERT INTO user VALUES(1,'homer','2aaab795b3836904f82efc6ca2285d927aed75206214e1da383418eb90c9052f');
INSERT INTO user VALUES(2,'marge','b4b811fa40505329ae871e52f03527c3720c9af7fb8607819658535c5484c41e');
INSERT INTO user VALUES(3,'bart','9551dadbf76a27457946e70d1aebebe2132f8d3bce6378d216c11853524dd3a6');
INSERT INTO user VALUES(4,'lisa','d84fe7e07bedb227cffff10009151d96fc944f6a1bd37cff60e8e4626a1eb1c3');
INSERT INTO user VALUES(5,'maggie','aae5be5f6474904b686f639e0fcfd2be440121cd889fa381a94b71750758345e');
COMMIT;
```

Once you know the structure of the database table, you can also issue **SQL queries**.
```
$ sqlite3 test.db "select username, password from user;"
homer|2aaab795b3836904f82efc6ca2285d927aed75206214e1da383418eb90c9052f
marge|b4b811fa40505329ae871e52f03527c3720c9af7fb8607819658535c5484c41e
bart|9551dadbf76a27457946e70d1aebebe2132f8d3bce6378d216c11853524dd3a6
lisa|d84fe7e07bedb227cffff10009151d96fc944f6a1bd37cff60e8e4626a1eb1c3
maggie|aae5be5f6474904b686f639e0fcfd2be440121cd889fa381a94b71750758345e
```

Alternatively, you can use the **DB Browser** to read the data via a GUI.

SQLite3 is a lightweight database engine that **does not have built-in 
user management or robust access control** features like some other 
database systems (e.g., MySQL, PostgreSQL). 

Here are some methods to **prevent unauthorized access to an SQLite3 database file**:

* **File System Permissions**: Ensure that the database file has strict file 
    system permissions set. Only allow specific users or groups to read or write 
    to the database file.

* **Operating System User Accounts**: Run your application under a specific user 
    account and ensure that the SQLite database file is only accessible by that user.

* **Encrypted File System**: Store the SQLite database on an encrypted file system 
    or an encrypted virtual disk image.

* **Data Encryption**: Only store sensitive data in encrypted form in the database. 


## SQL Injection Attack

SQL injection is a code injection technique that exploits a security 
vulnerability occurring in the database layer of an application. 

The vulnerability is present when user input is either incorrectly 
filtered for string literal escape characters embedded in SQL statements 
or user input is not strongly typed and thereby unexpectedly executed. 

**It allows an attacker to interfere with the queries that an application 
makes to its database**.

Here's a breakdown of how SQL injection works:

* **User Input**: An application typically takes user input through forms, 
    URL parameters, etc., and uses this input to construct SQL queries to 
    interact with the database.

* **Lack of Sanitization**: If the application does not properly sanitize 
    the user input (i.e., it does not remove or escape special characters 
    that have a specific meaning in SQL), an attacker can inject arbitrary 
    SQL code into the query.

* **Malicious SQL Execution**: The database then executes the malicious query. 
    This can lead to various harmful scenarios, such as unauthorized viewing 
    of data, deletion of data, and in severe cases, complete takeover of the 
    database.

_Example_: SQL Injection 
```SQL
-- Regular query:
SELECT * FROM user WHERE username='homer' AND password='2aaab795b3836904f82efc6ca2285d927aed75206214e1da383418eb90c9052f';

-- Attack: Use "' OR 1 --'" as username and "blah" as password (the password doesn't matter)
SELECT * FROM user WHERE username='' OR 1 --'' AND password='blah';
```
With this simple attack, all user data can be read.

To **prevent SQL injection attacks**, developers should:

* Use **Prepared Statements (with Parameterized Queries)**: They force the developer to first define 
    all the SQL code, and then pass in each parameter to the query later. 
    This coding style allows the database to distinguish between code and data, regardless of what 
    user input is supplied.

* **White List Input Validation**: This is where user input is checked against a set of rules for length, 
    type, and syntax, as well as against a list of known good input.

* **Employ Least Privilege**: The database connection should be made using an account that has the 
    least privileges necessary to perform its tasks. This minimizes the potential damage of a successful 
    SQL injection attack.

* **Regularly Update and Patch**: All your software should be kept up to date with the latest security 
    patches.


## References
* [YouTube: SQL Injection Attack](https://youtu.be/hCVzfmsg4m4?si=3i6toFq96PgCx79n)
* [SQL Injection Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html)

* [DB Browser for SQLite](https://sqlitebrowser.org/)
* [SQLite: Tutorial](https://www.sqlitetutorial.net/)

*Egon Teiniker, 2023, GPL v3.0*