#include <stdio.h>
#include <stdlib.h>
#include <sqlite3.h> 

int callback(void *NotUsed, int argc, char **argv, char **azColName) 
{
   int i;
   for(i = 0; i<argc; i++) 
   {
      printf(">> %s = %s\n", azColName[i], argv[i] ? argv[i] : "NULL");
   }
   printf("\n");
   return 0;
}

void select_user(sqlite3 *db, const char *username, const char *password) 
{
    char *errMsg = 0;
    char sqlSelect[256];

    snprintf(sqlSelect, sizeof(sqlSelect), "SELECT * FROM user WHERE username='%s' AND password='%s';", username, password);
    printf("Executing query: %s\n", sqlSelect);

    if (sqlite3_exec(db, sqlSelect, callback, 0, &errMsg) != SQLITE_OK) 
    {
        fprintf(stderr, "SQL error: %s\n", errMsg);
        sqlite3_free(errMsg);
    } 
    else 
    {
        fprintf(stdout, "Query executed successfully\n");
    }
}


int main(int argc, char* argv[])
{
    sqlite3 *db;
    int rc;

    rc = sqlite3_open("test.db", &db);
    if (rc)
    {
        fprintf(stderr, "Can't open database: %s\n", sqlite3_errmsg(db));
        return(0);
    } 
    else 
    {
        fprintf(stdout, "Opened database successfully\n");
    }

    // Regular SQL query
    select_user(db, "homer", "2aaab795b3836904f82efc6ca2285d927aed75206214e1da383418eb90c9052f");
   
    // SQL Injection attack 
    select_user(db, "homer' OR 1 --'", "blah");

    // SQL Injection attack 
    select_user(db, "' OR 1 --'", "blah");

    sqlite3_close(db);
    return 0;
}
