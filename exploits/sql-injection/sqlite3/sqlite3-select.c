#include <stdio.h>
#include <stdlib.h>
#include <sqlite3.h> 

int callback(void *NotUsed, int argc, char **argv, char **azColName) 
{
   int i;
   for(i = 0; i<argc; i++) 
   {
      printf(">> %s = %s\n", azColName[i], argv[i] ? argv[i] : "NULL");
   }
   printf("\n");
   return 0;
}


void select_users(sqlite3 *db)
{
    char *errMsg = 0;
    const char *sqlSelect = "SELECT * FROM user;";

    printf("Users in the database:\n");
    if (sqlite3_exec(db, sqlSelect, callback, 0, &errMsg) != SQLITE_OK)
    {
        fprintf(stderr, "Failed to select data: %s\n", errMsg);
        sqlite3_free(errMsg);
    } 
    else 
    {
        fprintf(stdout, "Data selected successfully\n");
    }
}

void select_user(sqlite3 *db, const char *username, const char *password) 
{
    sqlite3_stmt *stmt;
    const char *sqlSelect = "SELECT * FROM user WHERE username=? AND password=?;";
    if (sqlite3_prepare_v2(db, sqlSelect, -1, &stmt, NULL) != SQLITE_OK) 
    {
        fprintf(stderr, "Failed to prepare statement: %s\n", sqlite3_errmsg(db));
        return;
    }
    sqlite3_bind_text(stmt, 1, username, -1, SQLITE_STATIC);
    sqlite3_bind_text(stmt, 2, password, -1, SQLITE_STATIC);

    while(sqlite3_step(stmt) == SQLITE_ROW) 
    {
        printf("User found: ID = %d, Username = %s, Password = %s\n",
               sqlite3_column_int(stmt, 0),
               sqlite3_column_text(stmt, 1),
               sqlite3_column_text(stmt, 2));
    }

    sqlite3_finalize(stmt);
}

int main(int argc, char* argv[])
{
    sqlite3 *db;
    int rc;

    rc = sqlite3_open("test.db", &db);
    if (rc)
    {
        fprintf(stderr, "Can't open database: %s\n", sqlite3_errmsg(db));
        return(0);
    } 
    else 
    {
        fprintf(stdout, "Opened database successfully\n");
    }

   select_users(db);
   select_user(db, "homer", "2aaab795b3836904f82efc6ca2285d927aed75206214e1da383418eb90c9052f");

   sqlite3_close(db);
   return 0;
}